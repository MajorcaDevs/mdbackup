



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="mdbackup documentation">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Quick start - mdbackup documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#quick-start-guide" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="mdbackup documentation" aria-label="mdbackup documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              mdbackup documentation
            </span>
            <span class="md-header-nav__topic">
              
                Quick start
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/MajorcaDevs/mdbackup/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="mdbackup documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    mdbackup documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/MajorcaDevs/mdbackup/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Quick start
      </label>
    
    <a href="./" title="Quick start" class="md-nav__link md-nav__link--active">
      Quick start
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#first-configuration" class="md-nav__link">
    First configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#injecting-environment-variables" class="md-nav__link">
    Injecting environment variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    Compression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt" class="md-nav__link">
    Encrypt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-to-the-cloud" class="md-nav__link">
    Upload to the cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-end" class="md-nav__link">
    The end
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../steps/" title="Steps" class="md-nav__link">
      Steps
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Storage providers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Storage providers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/gdrive/" title="Google Drive" class="md-nav__link">
      Google Drive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/s3/" title="S3" class="md-nav__link">
      S3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/b2/" title="B2" class="md-nav__link">
      B2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/ftp/" title="FTP(S)" class="md-nav__link">
      FTP(S)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storage/sftp/" title="SFTP" class="md-nav__link">
      SFTP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Secrets providers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Secrets providers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/file/" title="File" class="md-nav__link">
      File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/vault/" title="Vault" class="md-nav__link">
      Vault
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../arguments/" title="Arguments" class="md-nav__link">
      Arguments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../run-as-service/" title="Run as a service" class="md-nav__link">
      Run as a service
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#first-configuration" class="md-nav__link">
    First configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#injecting-environment-variables" class="md-nav__link">
    Injecting environment variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    Compression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encrypt" class="md-nav__link">
    Encrypt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-to-the-cloud" class="md-nav__link">
    Upload to the cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-end" class="md-nav__link">
    The end
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/MajorcaDevs/mdbackup/blob/master/quick-start.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="quick-start-guide">Quick start guide<a class="headerlink" href="#quick-start-guide" title="Permanent link">&para;</a></h1>
<blockquote>
<p><code class="codehilite"><span class="err">mdbackup</span></code> is tested under Linux and macOS, but it should work on any platform where Python has support and has <code class="codehilite"><span class="err">bash</span></code>, except for Windows.</p>
</blockquote>
<p>Before installing the tool, make sure to have installed at least <code class="codehilite"><span class="err">rsync</span></code> and <code class="codehilite"><span class="err">bash</span></code>. Most Linux distributions have  both installed, some only <code class="codehilite"><span class="err">bash</span></code>. On macOS, both come installed by default. Also check that Python 3.6 or higher is installed (use [<code class="codehilite"><span class="err">brew</span></code>] on macOS for that).</p>
<p>In this guide, a virtual environment will be used to install and use the tool. It is not recommended to install it directly in the system.</p>
<p>First prepare the virtual environment. You can use <code class="codehilite"><span class="err">venv</span></code> or <code class="codehilite"><span class="err">virtualenv</span></code>, but the first will be used.</p>
<div class="codehilite"><pre><span></span><code>python -m venv .venv
python -m virtualenv .venv
</code></pre></div>

<blockquote>
<p>Note: <code class="codehilite"><span class="err">python</span></code> here it is referred to the python 3 executable. In some platforms will be <code class="codehilite"><span class="err">python3</span></code>.</p>
</blockquote>
<p>Once the environment is created, we must &ldquo;activate&rdquo; it:</p>
<div class="codehilite"><pre><span></span><code>. .venv/bin/activate
</code></pre></div>

<p>Now you can use <code class="codehilite"><span class="err">python</span></code> and <code class="codehilite"><span class="err">pip</span></code> and everything will work from and install to the virtual environment. Now you can download the tool and install it:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#Download using curl...</span>
curl -sSL https://github.com/MajorcaDevs/mdbackup/releases/latest/download/mdbackup.whl &gt; mdbackup.whl
<span class="c1">#...or wget</span>
wget https://github.com/MajorcaDevs/mdbackup/releases/latest/download/mdbackup.whl
<span class="c1">#If they don&#39;t work, go to https://github.com/MajorcaDevs/mdbackup/releases and copy the URL from the latest release</span>

pip install mdbackup.whl

mdbackup --help
</code></pre></div>

<p>To check if the tool is installed properly, run the help of the tool and you should get something like <a href="../arguments/">this</a>.</p>
<p>You can also use the <a href="../docker/">Docker container</a>. But it is recommended to read the guide to get an idea.</p>
<h2 id="first-configuration">First configuration<a class="headerlink" href="#first-configuration" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: this will get through getting an initial configuration for backups. To get in more detail, check out the <a href="../configuration/">Configuration</a> page.</p>
</blockquote>
<p>In order to get your first backup, the tool must be configured properly. To achieve this, you will learn the core concepts used in the tool and how to use them to fit your needs.</p>
<p>The tool needs three folders to work:</p>
<ul>
<li><code class="codehilite"><span class="err">config</span></code>: a folder where the configuration, and other files related to configuration, tokens or cookies are going to be stored.</li>
<li><code class="codehilite"><span class="err">steps</span></code>: a folder where the backup logic is stored in form of bash scripts.</li>
<li>*put a full path here*: the folder, placed in some folder, where the backups are going to be stored.</li>
</ul>
<p>The folder in where you are right now should have the following structure:</p>
<ul>
<li><code class="codehilite"><span class="na">.venv</span><span class="err">/</span></code><ul>
<li>&hellip;</li>
</ul>
</li>
<li><code class="codehilite"><span class="err">config/</span></code><ul>
<li><code class="codehilite"><span class="err">config.json</span></code></li>
</ul>
</li>
<li><code class="codehilite"><span class="err">steps/</span></code><ul>
<li><code class="codehilite"><span class="err">01.sh</span></code></li>
</ul>
</li>
<li><code class="codehilite"><span class="err">mdbackup.whl</span></code></li>
</ul>
<p>And the third folder, it does not matter where is placed, but it will be used soon to store backups. It can be a network storage, an external drive or a partition in some local drive. It is recommended to store them outside the root partition (<code class="codehilite"><span class="err">/</span></code>), if possible.</p>
<p>Did you notice the <code class="codehilite"><span class="err">config.json</span></code>? This file holds the <a href="../configuration/">configuration</a> of the tool. Write in it the following:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;backupsPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/the/path/to/the/folder/where/the/backups/are/going/to/be/stored&quot;</span><span class="p">,</span>
  <span class="nt">&quot;logLevel&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
  <span class="nt">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>Note: you can download the <a href="https://github.com/MajorcaDevs/mdbackup/releases/latest/download/config.schema.json">JSON Schema</a> and use it to validate the structure: <code class="codehilite"><span class="err">&quot;$schema&quot;: &quot;./config.schema.json&quot;,</span></code>. You can grab it from the latest release.</p>
</blockquote>
<p>This configuration is really basic and tells the tool where to place the backups, which log level to use (will be very verbose, but it is OK for now) and to inject no extra environment variables.</p>
<p>Now we need to define the logic to create backups. We called it <code class="codehilite"><span class="err">steps</span></code>. A step is just a bash script (without the shebang <code class="codehilite"><span class="err">!#</span></code>) that do some actions to copy/backup any data, files or folders to the backup folder (referring &ldquo;backup folder&rdquo; to the folder where the current backup is going to be stored). The tool defines some <a href="../steps/#function-utilities">predefined functions</a> that are useful to make most common backup operations. Some of them requires to have installed extra CLIs or to have installed Docker. But if these functions are not used, no errors will arise.</p>
<p>The steps are executed following the natural order (alphanumeric order) of the names of the files. For example, <code class="codehilite"><span class="err">01.sh</span></code> will run before <code class="codehilite"><span class="err">02.sh</span></code>. It can be as many scripts as desired, or just one. It does not matter. So now we will give some contents to <code class="codehilite"><span class="err">01.sh</span></code> (the file shown in the tree).</p>
<div class="codehilite"><pre><span></span><code>backup-folder <span class="s2">&quot;/home/YourUser&quot;</span> home  <span class="c1">#macOS users, use &quot;/Users/YourUser&quot;</span>
</code></pre></div>

<p>This step will copy your home directory and all its contents into the backup folder using <code class="codehilite"><span class="err">rsync</span></code>. With one line, you will get a full backup of a folder! You can use any other folder you want just to try, this is an example. Check that the script has execution permissions for the <code class="codehilite"><span class="err">user</span></code>, and possible for <code class="codehilite"><span class="err">all</span></code>: <code class="codehilite"><span class="err">chmod ua+x ./steps/01.sh</span></code>.</p>
<p>Now try running the tool: <code class="codehilite"><span class="err">mdbackup</span></code>. If everything is well configured, you will have a new folder in the backups folder with the date and time of now and with your folder copied. Well, try now to make a backup again. If the folder being copied is large enough, you will notice that this time, the backup took less time than the first time. This is because the mode in which <code class="codehilite"><span class="err">rsync</span></code> runs checks which files have been modified and just copies these ones. The rest of unmodified files are hard-linked from the latest backup. It&rsquo;s an &ldquo;incremental&rdquo; backup!</p>
<p>Note that <code class="codehilite"><span class="err">current</span></code> folder is always present and is a soft link to the latest backup. So it&rsquo;s easy to access to the latest backup from the file explorer or from the command line :)</p>
<p>Now you have backups of whatever you want! Just configure the tool and write the right scripts to fit your needs.</p>
<blockquote>
<p>Note: it is possible that you will need to run the tool as root to access some system folders. Remember that the virtual environment is not inherited when using <code class="codehilite"><span class="err">sudo</span></code>. Make your own script, or checkout one of <a href="https://github.com/MajorcaDevs/mdbackup/tree/master/contrib">the contrib folder</a>.</p>
</blockquote>
<h2 id="injecting-environment-variables">Injecting environment variables<a class="headerlink" href="#injecting-environment-variables" title="Permanent link">&para;</a></h2>
<p>Some of the <a href="../steps/#function-utilities">steps</a> have as parameters some environment variables. These can be defined in the <code class="codehilite"><span class="err">env</span></code> section of the json. The object must be a simple Key/Value structure. Complex structures (like objects or arrays) are not allowed.</p>
<p>Let&rsquo;s try to make a backup from a postgres database with the predefined function. Also these variables can be used natively with some postgres tools because they also understand them. For this example, <code class="codehilite"><span class="err">pg_dump</span></code> must be installed on the system.</p>
<p>First, the <code class="codehilite"><span class="err">env</span></code> must be changed to add the new settings:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="s2">&quot;...&quot;</span><span class="o">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;pghost&quot;</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pguser&quot;</span><span class="o">:</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pgpassword&quot;</span><span class="o">:</span> <span class="s2">&quot;WonderfulPassword123&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Then, we will add a new step script called <code class="codehilite"><span class="err">02.sh</span></code> with the following contents:</p>
<div class="codehilite"><pre><span></span><code>backup-postgres-database <span class="s2">&quot;databasename&quot;</span>
</code></pre></div>

<p>The tool will read the environment variables, and inject them in the scripts environment when they are running. The key are transformed to be upper case, so you don&rsquo;t need to.</p>
<p>If everything went well, you now will have a <code class="codehilite"><span class="err">databasename.sql</span></code> file in the backup folder.</p>
<h2 id="compression">Compression<a class="headerlink" href="#compression" title="Permanent link">&para;</a></h2>
<p>What if your postgres backup takes some MB and if the file were compressed, will be a few KBs? Or what if you want to upload to a cloud storage and you want to save some bytes if possible when uploading them? <em>(That&rsquo;s an spoiler, yes)</em></p>
<p>The tool, with the help of <code class="codehilite"><span class="err">tar</span></code>, <code class="codehilite"><span class="err">xz</span></code> and <code class="codehilite"><span class="err">gzip</span></code> commands, can compress whatever you want. And some of the predefined functions takes advantage of this and compress for you some of the files. The configuration for this is simple:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;compression&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
    <span class="nt">&quot;level&quot;</span><span class="p">:</span> <span class="mi">7</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>With this simple configuration, the <code class="codehilite"><span class="err">backup-postgres-database</span></code> and many more will output a compressed file. You can even take advantage of this by using the helper function <a href="./steps/#compress-encrypt"><code class="codehilite"><span class="err">compress-encrypt</span></code></a> that will run a command that must output the data to <code class="codehilite"><span class="err">stdout</span></code> and will compress (and encrypt [oh no, another spoiler]) it using the configuration.</p>
<h2 id="encrypt">Encrypt<a class="headerlink" href="#encrypt" title="Permanent link">&para;</a></h2>
<p>You already know that you can encrypt, but you don&rsquo;t know how yet. You need <strong>OpenGPG 2</strong> in order to cypher files. And as well as the compression, will be used automatically by some functions, and in the upload to storage providers.</p>
<p>Most Linux distributions have installed <code class="codehilite"><span class="err">gpg</span></code> tools, but you must check the version. On macOS, install <a href="https://gpgtools.org">GPGTools</a>.</p>
<p>There&rsquo;s two ways to encrypt data, in this guide will be using the passphrase. Here is a configuration example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cypher&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;gpg-passphrase&quot;</span><span class="p">,</span>
    <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;ThisIsAPassphrase321&quot;</span><span class="p">,</span>
    <span class="nt">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>Note: the algorithm changes between distributions. Check the available in <code class="codehilite"><span class="err">gpg --version</span></code>. In this guide we will be using AES256.</p>
</blockquote>
<p>Now the <code class="codehilite"><span class="err">backup-postgres-database</span></code> will be compressed and encrypted using a passphrase and <code class="codehilite"><span class="err">gpg</span></code>, and any of the functions that uses <a href="./steps/#compress-encrypt"><code class="codehilite"><span class="err">compress-encrypt</span></code></a>.</p>
<h2 id="upload-to-the-cloud">Upload to the cloud<a class="headerlink" href="#upload-to-the-cloud" title="Permanent link">&para;</a></h2>
<p>Well, you can also use an FTP server for this, but it&rsquo;s cool to say <em>&ldquo;TO THE CLOUD&rdquo;</em>.</p>
<p>If desired, the backups can be uploaded to what we call &ldquo;storage provider&rdquo;. It can be a FTP or SFTP server, or a Cloud Storage (like S3 or Google Drive). This is run after the backup is done, and can be uploaded to one or more storage providers. Also to speed up the upload, the folders are written into a <code class="codehilite"><span class="err">tar</span></code> file, compressed (if configured) and encrypted (if configured).</p>
<blockquote>
<p>It is recommended to, at least, configure the compression in order to save some storage at the cloud.</p>
</blockquote>
<p>There are many <a href="./storage">storage providers</a> to choose. In the guid will be using a FTP server to quickly show how to upload files. <em>Also because this is the only storage provider that does not need to install any extra packages.</em></p>
<p>This is the configuration for the FTP:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;storage&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ftp&quot;</span><span class="p">,</span>
      <span class="nt">&quot;backupsPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/backups&quot;</span><span class="p">,</span>
      <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;ftp.local&quot;</span><span class="p">,</span>
      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;anonymous&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>This will upload the files to the FTP server <code class="codehilite"><span class="err">ftp.local</span></code>, in the folder <code class="codehilite"><span class="err">/backups</span></code> using the <code class="codehilite"><span class="err">anonymous</span></code> user and no password.</p>
<h2 id="the-end">The end<a class="headerlink" href="#the-end" title="Permanent link">&para;</a></h2>
<p>There&rsquo;s more to learn about the tool, but this is a rather good introduction to it. Take a look to the other sections of this documentation to learn and discover new stuff of the tool.</p>
<p>Concerned about too much hardcoded credentials in the configuration file? Check out the <a href="./secrets">Secret backends</a>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../configuration/" title="Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            MajorcaDevs 2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>